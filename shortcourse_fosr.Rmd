---
title: "Function-on-Scalar Regression"
output:
  html_document: 
    code_folding: hide
    toc: true
    toc_float: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 8,
  fig.height = 4
)
```

This page contains a combination of traditional lecture materials (slides) and code demonstrating the relevant methods. The short course will proceed by working through both. We will use several recent packages in our examples; see the [About](./About.html) page for information about the package versions.

```{r setup}
library(tidyverse)
library(refund)
library(refund.shiny)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

In this section we'll use the [HeadStart data](./Data.html) to motivate the function-on-scalar regression model. Our main outcome of interest is the observed physical activity profile, with predictors including age, sex, and season. This material draws heavily from [Goldsmith et al](http://jeffgoldsmith.com/Downloads/HeadStart.pdf) (2016).


## Function-on-scalar regression

<script async class="speakerdeck-embed" data-id="337ceb9014d244a1a8b13282f00bae81" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
<div style="margin-bottom:5px"> <strong> <a href="https://speakerdeck.com/jeffgoldsmith/icampam-notation" title="ICAMPAM Short Course: FoSR" target="_blank">ICAMPAM Short Course: FoSR</a> </strong> from <strong><a href="https://speakerdeck.com/jeffgoldsmith" target="_blank">Jeff Goldsmith</a></strong>. </div>


## Practical example

Rainbow plot

```{r Accel_explore, eval = TRUE}
load("./DataCode/HeadStart.RDA")

as_refundObj(accel) %>% 
	left_join(dplyr::select(covariate_data, id, season_warm)) %>%
	ggplot(aes(x = index, y = value, group = id, color = season_warm)) + geom_path(alpha = .1) +
	geom_smooth(aes(group = season_warm), se = FALSE)
```

To motivate the use of variable selection methods for this dataset, we can examine the results of an analysis that does not shrink coefficients. The code below fits such a model and shows all resulting coefficients; while there are some obvious large effects, many others are small and may not be necessary.

```{r Accel_varselect_motivate, eval = TRUE}
temp_df = covariate_data
temp_df$accel = accel

fit_unpenalized = bayes_fosr(accel ~ season_warm + sex_female + BMIZ + TV_g2hr + video_g1hr +
														 	mom_work_yes + asthma_yes + child_age + mom_age + educ_mom + num_rooms + 
														 	mom_born_US + tricep + subscap + skinfold, data = temp_df)

as_refundObj(fit_unpenalized$beta.hat[-1,]) %>% 
	ggplot(aes(x = index, y = value, group = id)) + geom_path(alpha = .5)
```

(Incidentally, as for FPCA analyses, the `refund.shiny` package has helpful tools for visualizing the results of a function-on-scalar regression analysis.)

```{r Accel_fosr_interactive, eval = FALSE}
plot_shiny(fit_unpenalized)
```

